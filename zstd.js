!function(r){"undefined"!=typeof module&&"object"==typeof exports?module.exports=r():"undefined"!=typeof define&&define.amd?define(["fzstd",r]):("undefined"!=typeof self?self:this).fzstd=r()}(function(){function u(r,t,e,n){if(Z.prototype.copyWithin)return Z.prototype.copyWithin.call(r,t,e,n);for((null==e||e<0)&&(e=0),(null==n||n>r.length)&&(n=r.length);e<n;)r[t++]=r[e++]}function f(r,t){var e,n,s,i,a,o,u,f=r[0]|r[1]<<8|r[2]<<16;return 3126568==f&&253==r[3]?(u=(n=r[4])>>5&1,e=n>>2&1,i=3&n,a=n>>6,8&n&&K(0),s=b(r,n=6-u,i=3==i?4:i),o=a=b(r,n+=i,i=a?1<<a:u)+(1==a&&256),2145386496<(o=u?o:(u=1<<10+(r[5]>>3))+(u>>3)*(7&r[5]))&&K(1),(u=new Z((1==t?a||o:t?0:o)+12))[0]=1,u[4]=4,u[8]=8,{b:n+i,y:0,l:0,d:s,w:t&&1!=t?t:u.subarray(12),e:o,o:new c(u.buffer,0,3),u:a,c:e,m:Math.min(131072,o)}):25481893==(f>>4|r[3]<<20)?y(r,4)+8:void K(0)}function r(r,t){for(var e=r.length,n=new c(e),s=0;s<e;++s)n[s]=t,t+=1<<r[s];return n}function h(r,t,e){var n=t.b,s=(i=r[n])>>1&3,i=(t.l=1&i,i>>3|r[n+1]<<5|r[n+2]<<13),a=(n+=3)+i;if(1==s)return n>=r.length?void 0:(t.b=n+1,e?(J(e,r[n],t.y,t.y+=i),e):J(new Z(i),r[n]));if(!(a>r.length)){if(0==s)return t.b=a,e?(e.set(r.subarray(n,a),t.y),t.y+=i,e):G(r,n,a);if(2==s){var i=r[n],s=3&i,o=i>>2&3,u=i>>4,f=0,h=0,l=(s<2?1&o?u|=r[++n]<<4|(2&o&&r[++n]<<12):u=i>>3:f=(h=o)<2?(u|=(63&r[++n])<<4,r[n]>>6|r[++n]<<2):2==o?(u|=r[++n]<<4|(3&r[++n])<<12,r[n]>>2|r[++n]<<6):(u|=r[++n]<<4|(63&r[++n])<<12,r[n]>>6|r[++n]<<2|r[++n]<<10),++n,e?e.subarray(t.y,t.y+t.m):new Z(t.m)),c=l.length-u,b=(0==s?l.set(r.subarray(n,n+=u),c):1==s?J(l,r[n++],c):(i=t.h,2==s?(f+=n-(n=(o=Q(r,n))[0]),t.h=i=o[1]):i||K(0),(h?er:tr)(r.subarray(n,n+=f),l.subarray(c),i)),r[n++]);if(b){255==b?b=32512+(r[n++]|r[n++]<<8):127<b&&(b=b-128<<8|r[n++]);var y=r[n++];3&y&&K(0);for(var v=[V,X,R],p=2;-1<p;--p){var w,d=y>>2+(p<<1)&3;1==d?(w=new Z([0,0,r[n++]]),v[p]={s:w.subarray(2,3),n:w.subarray(0,1),t:new q(w.buffer,0,1),b:0}):2==d?(n=(w=P(r,n,9-(1&p)))[0],v[p]=w[1]):3==d&&(t.t||K(0),v[p]=t.t[p])}var s=t.t=v,g=s[0],m=s[1],z=s[2],o=r[a-1],E=(o||K(0),(a<<3)-8+N(o)-z.b),k=0,A=(r[U=E>>3]|r[1+U]<<8)>>(7&E)&(1<<z.b)-1,T=(r[U=(E-=m.b)>>3]|r[1+U]<<8)>>(7&E)&(1<<m.b)-1,F=(r[U=(E-=g.b)>>3]|r[1+U]<<8)>>(7&E)&(1<<g.b)-1;for(++b;--b;){var S=z.s[A],O=z.n[A],x=g.s[F],C=g.n[F],B=m.s[T],H=m.n[T],I=1<<B,B=I+((r[U=(E-=B)>>3]|r[1+U]<<8|r[2+U]<<16|r[3+U]<<24)>>>(7&E)&I-1),U=(E-=_[x])>>3,D=rr[x]+((r[U]|r[1+U]<<8|r[2+U]<<16)>>(7&E)&(1<<_[x])-1),M=(U=(E-=Y[S])>>3,$[S]+((r[U]|r[1+U]<<8|r[2+U]<<16)>>(7&E)&(1<<Y[S])-1));for(U=(E-=O)>>3,A=z.t[A]+((r[U]|r[1+U]<<8)>>(7&E)&(1<<O)-1),U=(E-=C)>>3,F=g.t[F]+((r[U]|r[1+U]<<8)>>(7&E)&(1<<C)-1),U=(E-=H)>>3,T=m.t[T]+((r[U]|r[1+U]<<8)>>(7&E)&(1<<H)-1),3<B?(t.o[2]=t.o[1],t.o[1]=t.o[0],t.o[0]=B-=3):(I=B-(0!=M))?(B=3==I?t.o[0]-1:t.o[I],1<I&&(t.o[2]=t.o[1]),t.o[1]=t.o[0],t.o[0]=B):B=t.o[0],p=0;p<M;++p)l[k+p]=l[c+p];c+=M;var W=(k+=M)-B;if(W<0){var j=-W,L=t.e+W;for(D<j&&(j=D),p=0;p<j;++p)l[k+p]=t.w[L+p];k+=j,D-=j,W=0}for(p=0;p<D;++p)l[k+p]=l[W+p];k+=D}if(k!=c)for(;c<l.length;)l[k++]=l[c++];else k=l.length;e?t.y+=k:l=G(l,0,k)}else if(e){if(t.y+=u,c)for(p=0;p<u;++p)l[p]=l[c+p]}else c&&(l=G(l,c));return t.b=a,l}K(2)}}function l(r,t){if(1==r.length)return r[0];for(var e=new Z(t),n=0,s=0;n<r.length;++n){var i=r[n];e.set(i,s),s+=i.length}return e}var t={},x=ArrayBuffer,Z=Uint8Array,q=Uint16Array,B=Int16Array,c=(Uint32Array,Int32Array),G=function(r,t,e){if(Z.prototype.slice)return Z.prototype.slice.call(r,t,e);(null==e||e>r.length)&&(e=r.length);var n=new Z(e-(t=null==t||t<0?0:t));return n.set(r.subarray(t,e)),n},J=function(r,t,e,n){if(Z.prototype.fill)return Z.prototype.fill.call(r,t,e,n);for((null==e||e<0)&&(e=0),(null==n||n>r.length)&&(n=r.length);e<n;++e)r[e]=t;return r},n=(t.ZstdErrorCode={InvalidData:0,WindowSizeTooLarge:1,InvalidBlockType:2,FSEAccuracyTooHigh:3,DistanceTooFarBack:4,UnexpectedEOF:5},["invalid zstd data","window size too large (>2046MB)","invalid block type","FSE accuracy too high","match distance too far back","unexpected EOF"]),K=function(r,t,e){t=Error(t||n[r]);if(t.code=r,Error.captureStackTrace&&Error.captureStackTrace(t,K),e)return t;throw t},b=function(r,t,e){for(var n=0,s=0;n<e;++n)s|=r[t++]<<(n<<3);return s},y=function(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16|r[t+3]<<24)>>>0},N=function(r){for(var t=0;1<<t<=r;++t);return t-1},P=function(r,t,e){var n=4+(t<<3),s=5+(15&r[t]);e<s&&K(3);for(var i=1<<s,a=i,o=-1,u=-1,f=i,t=new x(512+(i<<2)),h=new B(t,0,256),l=new q(t,0,256),c=new q(t,512,i),e=512+(i<<1),b=new Z(t,e,i),y=new Z(t,e+i);o<255&&0<a;){var v=N(a+1),p=n>>3,w=(1<<v+1)-1,p=(r[p]|r[1+p]<<8|r[2+p]<<16)>>(7&n)&w,d=(1<<v)-1,w=w-a-1,g=p&d;if(g<w?(n+=v,p=g):(n+=v+1,d<p&&(p-=w)),h[++o]=--p,-1==p?(a+=p,b[--f]=o):a-=p,!p)do{var m=n>>3,m=(r[m]|r[1+m]<<8)>>(7&n)&3}while(n+=2,o+=m,3==m)}(255<o||a)&&K(0);for(var z=0,E=(i>>1)+(i>>3)+3,k=i-1,A=0;A<=o;++A){var T=h[A];if(T<1)l[A]=-T;else for(u=0;u<T;++u)for(b[z]=A;f<=(z=z+E&k););}for(z&&K(0),u=0;u<i;++u){var F=l[b[u]]++,S=y[u]=s-N(F);c[u]=(F<<S)-i}return[n+7>>3,{b:s,s:b,n:y,t:c}]},Q=function(r,t){var e=0,n=-1,s=new Z(292),i=r[t],a=s.subarray(0,256),o=s.subarray(256,268),u=new q(s.buffer,268);if(i<128){var s=P(r,t+1,6),f=s[1],h=s[0]<<3,s=r[t+=i];s||K(0);for(var l=0,c=0,b=f.b,y=b,v=(++t<<3)-8+N(s);!((v-=b)<h);){var p=v>>3;if(a[++n]=f.s[l+=(r[p]|r[1+p]<<8)>>(7&v)&(1<<b)-1],(v-=y)<h)break;a[++n]=f.s[c+=(r[p=v>>3]|r[1+p]<<8)>>(7&v)&(1<<y)-1],b=f.n[l],l=f.t[l],y=f.n[c],c=f.t[c]}255<++n&&K(0)}else{for(n=i-127;e<n;e+=2){var w=r[++t];a[e]=w>>4,a[e+1]=15&w}++t}for(var d=0,e=0;e<n;++e)11<(g=a[e])&&K(0),d+=g&&1<<g-1;var g,m=N(d)+1,s=1<<m,i=s-d;for(i&i-1&&K(0),a[n++]=N(i)+1,e=0;e<n;++e)++o[a[e]=(g=a[e])&&m+1-g];var i=new Z(s<<1),z=i.subarray(0,s),E=i.subarray(s);for(u[m]=0,e=m;0<e;--e){var k=u[e];J(E,e,k,u[e-1]=k+o[e]*(1<<m-e))}for(u[0]!=s&&K(0),e=0;e<n;++e){var A,T=a[e];T&&(A=u[T],J(z,e,A,u[T]=A+(1<<m-T)))}return[t,{n:E,b:m,s:z}]},R=P(new Z([81,16,99,140,49,198,24,99,12,33,196,24,99,102,102,134,70,146,4]),0,6)[1],V=P(new Z([33,20,196,24,99,140,33,132,16,66,8,33,132,16,66,8,33,68,68,68,68,68,68,68,68,36,9]),0,6)[1],X=P(new Z([32,132,16,66,102,70,68,68,68,68,36,73,2]),0,5)[1],Y=new Z(new c([0,0,0,0,16843009,50528770,134678020,202050057,269422093]).buffer,0,36),$=r(Y,0),_=new Z(new c([0,0,0,0,0,0,0,0,16843009,50528770,117769220,185207048,252579084,16]).buffer,0,53),rr=r(_,3),tr=function(r,t,e){var n=r.length,s=t.length,i=r[n-1],a=(1<<e.b)-1,o=-e.b;i||K(0);for(var u=0,f=e.b,h=(n<<3)-8+N(i)-f,l=-1;o<h&&l<s;){var c=h>>3;t[++l]=e.s[u=(u<<f|(r[c]|r[1+c]<<8|r[2+c]<<16)>>(7&h))&a],h-=f=e.n[u]}h==o&&l+1==s||K(0)},er=function(r,t,e){var n=6,s=t.length+3>>2,i=s<<1,a=s+i;tr(r.subarray(6,n+=r[0]|r[1]<<8),t.subarray(0,s),e),tr(r.subarray(n,n+=r[2]|r[3]<<8),t.subarray(s,i),e),tr(r.subarray(n,n+=r[4]|r[5]<<8),t.subarray(i,a),e),tr(r.subarray(n),t.subarray(a),e)};function e(r){this.ondata=r,this.c=[],this.l=0,this.z=0}return t.decompress=function(r,t){for(var e=0,n=[],s=+!t,i=0;r.length;){var a=f(r,s||t);if("object"==typeof a){for(s?(t=null,a.w.length==a.u&&(n.push(t=a.w),i+=a.u)):(n.push(t),a.e=0);!a.l;){var o=h(r,a,t);o||K(5),t?a.e=a.y:(n.push(o),i+=o.length,u(a.w,0,o.length),a.w.set(o,a.w.length-o.length))}e=a.b+4*a.c}else e=a;r=r.subarray(e)}return l(n,i)},e.prototype.push=function(r,t){"number"==typeof this.s&&(e=Math.min(r.length,this.s),r=r.subarray(e),this.s-=e);var e=r.length+this.l;if(!this.s){if(t){if(!e)return;e<5&&K(5)}else if(e<18)return this.c.push(r),void(this.l=e);if(this.l&&(this.c.push(r),r=l(this.c,e),this.c=[],this.l=0),"number"==typeof(this.s=f(r)))return this.push(r,t)}if("number"!=typeof this.s)if(e<(this.z||4))t&&K(5),this.c.push(r),this.l=e;else if(this.l&&(this.c.push(r),r=l(this.c,e),this.c=[],this.l=0),!this.z&&e<(this.z=2&r[this.s.b]?5:4+(r[this.s.b]>>3|r[this.s.b+1]<<5|r[this.s.b+2]<<13)))t&&K(5),this.c.push(r),this.l=e;else for(this.z=0;;){var n,s=h(r,this.s);if(!s)return t&&K(5),n=r.subarray(this.s.b),this.s.b=0,this.c.push(n),void(this.l+=n.length);if(this.ondata(s,!1),u(this.s.w,0,s.length),this.s.w.set(s,this.s.w.length-s.length),this.s.l)return n=r.subarray(this.s.b),this.s=4*this.s.c,void this.push(n,t)}},t.Decompress=e,t});
